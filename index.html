<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@pojntfx/dudirekta</title><meta name="description" content="Documentation for @pojntfx/dudirekta"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os"</script><header class="tsd-page-toolbar">
<div class="tsd-toolbar-contents container">
<div class="table-cell" id="tsd-search" data-base=".">
<div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M15.7824 13.833L12.6666 10.7177C12.5259 10.5771 12.3353 10.499 12.1353 10.499H11.6259C12.4884 9.39596 13.001 8.00859 13.001 6.49937C13.001 2.90909 10.0914 0 6.50048 0C2.90959 0 0 2.90909 0 6.49937C0 10.0896 2.90959 12.9987 6.50048 12.9987C8.00996 12.9987 9.39756 12.4863 10.5008 11.6239V12.1332C10.5008 12.3332 10.5789 12.5238 10.7195 12.6644L13.8354 15.7797C14.1292 16.0734 14.6042 16.0734 14.8948 15.7797L15.7793 14.8954C16.0731 14.6017 16.0731 14.1267 15.7824 13.833ZM6.50048 10.499C4.29094 10.499 2.50018 8.71165 2.50018 6.49937C2.50018 4.29021 4.28781 2.49976 6.50048 2.49976C8.71001 2.49976 10.5008 4.28708 10.5008 6.49937C10.5008 8.70852 8.71314 10.499 6.50048 10.499Z" fill="var(--color-text)"></path></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div>
<div class="field">
<div id="tsd-toolbar-links"></div></div>
<ul class="results">
<li class="state loading">Preparing search index...</li>
<li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@pojntfx/dudirekta</a></div>
<div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="7" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="11" width="14" height="2" fill="var(--color-text)"></rect></svg></a></div></div></header>
<div class="container container-main">
<div class="col-8 col-content">
<div class="tsd-page-title">
<h2>@pojntfx/dudirekta</h2></div>
<div class="tsd-panel tsd-typography">
<a href="#dudirekta" id="dudirekta" style="color: inherit; text-decoration: none;">
  <h1>dudirekta</h1>
</a>
<p><img src="./docs/logo-readme.png" alt="Logo"></p>
<p>Transport-agnostic framework that allows exposing and calling functions on both clients and servers.</p>
<p><img src="https://img.shields.io/badge/go%20version-%3E=1.18-61CFDD.svg" alt="Go Version">
<a href="https://pkg.go.dev/github.com/pojntfx/dudirekta"><img src="https://pkg.go.dev/badge/github.com/pojntfx/dudirekta.svg" alt="Go Reference"></a>
<a href="https://github.com/pojntfx/dudirekta/actions/workflows/bun.yaml"><img src="https://github.com/pojntfx/dudirekta/actions/workflows/bun.yaml/badge.svg" alt="npm CI"></a>
<a href="https://www.npmjs.com/package/@pojntfx/dudirekta"><img src="https://img.shields.io/npm/v/@pojntfx/dudirekta" alt="npm: @pojntfx/dudirekta"></a>
<a href="https://pojntfx.github.io/dudirekta"><img src="https://img.shields.io/badge/TypeScript%20-docs-blue.svg" alt="TypeScript docs"></a>
<a href="https://matrix.to/#/#dudirekta:matrix.org?via=matrix.org"><img src="https://img.shields.io/matrix/dudirekta:matrix.org" alt="Matrix"></a></p>

<a href="#overview" id="overview" style="color: inherit; text-decoration: none;">
  <h2>Overview</h2>
</a>
<p>dudirekta is a novel RPC framework with a unique feature: It allows exposing functions on <strong>both the client and server</strong>!</p>
<p>It enables you to ...</p>
<ul>
<li><strong>Call remote functions transparently</strong>: dudirekta makes use of reflection, so you can call functions as though they were local without defining your own protocol or generating code</li>
<li><strong>Call functions on the client from the server</strong>: Unlike most RPC frameworks, dudirekta allows for functions to be exposed on both the server and the client, enabling its use in new usecases such as doing bidirectional data transfer without subscriptions or pushing information before the client requests it</li>
<li><strong>Implement RPCs on any transport layer</strong>: By being able to work with any <code>io.ReadWriteCloser</code>, you can build services using dudirekta on pretty much any transport layer such as TCP, WebSockets or even WebRTC, meaning it can run in the browser!</li>
<li><strong>Pass closures and callbacks to RPCs</strong>: Thanks to its bidirectional capabilities, dudirekta can use closures and callbacks transparently, just like a local function call!</li>
</ul>

<a href="#installation" id="installation" style="color: inherit; text-decoration: none;">
  <h2>Installation</h2>
</a>
<p>You can add dudirekta to your Go project by running the following:</p>
<pre><code class="language-shell"><span class="hl-0">$</span><span class="hl-1"> </span><span class="hl-2">go</span><span class="hl-1"> </span><span class="hl-2">get</span><span class="hl-1"> </span><span class="hl-2">github.com/pojntfx/dudirekta/...@latest</span>
</code></pre>
<p>There is also a minimal TypeScript version for browser support (without transparent support for closures); you can install it like so:</p>
<pre><code class="language-shell"><span class="hl-0">$</span><span class="hl-1"> </span><span class="hl-2">npm</span><span class="hl-1"> </span><span class="hl-2">i</span><span class="hl-1"> </span><span class="hl-3">-s</span><span class="hl-1"> </span><span class="hl-2">@pojntfx/dudirekta</span>
</code></pre>
<p>This README&#39;s documentation only covers the Go version. For the browser version, please check out <a href="https://github.com/pojntfx/hydrapp">Hydrapp</a>, it uses dudirekta in its examples. You can find the complete package reference here: <a href="https://pojntfx.github.io/dudirekta"><img src="https://img.shields.io/badge/TypeScript%20-docs-blue.svg" alt="TypeScript docs"></a>.</p>

<a href="#usage" id="usage" style="color: inherit; text-decoration: none;">
  <h2>Usage</h2>
</a>
<blockquote>
<p>TL;DR: Define the local and remote functions as struct methods, add them to a registry and link it with a transport</p>
</blockquote>

<a href="#1-define-local-functions" id="1-define-local-functions" style="color: inherit; text-decoration: none;">
  <h3>1. Define Local Functions</h3>
</a>
<p>dudirekta uses reflection to create the glue code required to expose and call functions. Start by defining your server&#39;s exposed functions like so:</p>
<pre><code class="language-go"><span class="hl-4">// server.go</span><br/><br/><span class="hl-3">type</span><span class="hl-1"> </span><span class="hl-5">local</span><span class="hl-1"> </span><span class="hl-3">struct</span><span class="hl-1"> {</span><br/><span class="hl-1">    counter </span><span class="hl-5">int64</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">func</span><span class="hl-1"> (s *local) </span><span class="hl-0">Increment</span><span class="hl-1">(ctx context.Context, delta </span><span class="hl-5">int64</span><span class="hl-1">) (</span><span class="hl-5">int64</span><span class="hl-1">, </span><span class="hl-5">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    log.</span><span class="hl-0">Println</span><span class="hl-1">(</span><span class="hl-2">&quot;Incrementing counter by&quot;</span><span class="hl-1">, delta, </span><span class="hl-2">&quot;for peer with ID&quot;</span><span class="hl-1">, rpc.</span><span class="hl-0">GetRemoteID</span><span class="hl-1">(ctx))</span><br/><br/><span class="hl-1">    </span><span class="hl-6">return</span><span class="hl-1"> atomic.</span><span class="hl-0">AddInt64</span><span class="hl-1">(&amp;s.counter, delta), </span><span class="hl-3">nil</span><br/><span class="hl-1">}</span>
</code></pre>
<p>In your client, define the exposed functions like so:</p>
<pre><code class="language-go"><span class="hl-4">// client.go</span><br/><br/><span class="hl-3">type</span><span class="hl-1"> </span><span class="hl-5">local</span><span class="hl-1"> </span><span class="hl-3">struct</span><span class="hl-1">{}</span><br/><br/><span class="hl-3">func</span><span class="hl-1"> (s *local) </span><span class="hl-0">Println</span><span class="hl-1">(ctx context.Context, msg </span><span class="hl-5">string</span><span class="hl-1">) </span><span class="hl-5">error</span><span class="hl-1"> {</span><br/><span class="hl-1">    log.</span><span class="hl-0">Println</span><span class="hl-1">(</span><span class="hl-2">&quot;Printing message&quot;</span><span class="hl-1">, msg, </span><span class="hl-2">&quot;for peer with ID&quot;</span><span class="hl-1">, rpc.</span><span class="hl-0">GetRemoteID</span><span class="hl-1">(ctx))</span><br/><br/><span class="hl-1">    fmt.</span><span class="hl-0">Println</span><span class="hl-1">(msg)</span><br/><br/><span class="hl-1">    </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-3">nil</span><br/><span class="hl-1">}</span>
</code></pre>
<p>The following limitations on which functions you can expose exist:</p>
<ul>
<li>Functions must have <code>context.Context</code> as their first argument</li>
<li>Functions can not have variadic arguments</li>
<li>Functions must return either an error or a single value and an error</li>
</ul>

<a href="#2-define-remote-functions" id="2-define-remote-functions" style="color: inherit; text-decoration: none;">
  <h3>2. Define Remote Functions</h3>
</a>
<p>Next, define the functions exposed by the client to the server using a struct without method implementations:</p>
<pre><code class="language-go"><span class="hl-4">// server.go</span><br/><br/><span class="hl-3">type</span><span class="hl-1"> </span><span class="hl-5">remote</span><span class="hl-1"> </span><span class="hl-3">struct</span><span class="hl-1"> {</span><br/><span class="hl-1">    Println </span><span class="hl-3">func</span><span class="hl-1">(ctx context.Context, msg </span><span class="hl-5">string</span><span class="hl-1">) </span><span class="hl-5">error</span><br/><span class="hl-1">}</span>
</code></pre>
<p>And do the same for the client:</p>
<pre><code class="language-go"><span class="hl-4">// client.go</span><br/><br/><span class="hl-3">type</span><span class="hl-1"> </span><span class="hl-5">remote</span><span class="hl-1"> </span><span class="hl-3">struct</span><span class="hl-1"> {</span><br/><span class="hl-1">    Increment </span><span class="hl-3">func</span><span class="hl-1">(ctx context.Context, delta </span><span class="hl-5">int64</span><span class="hl-1">) (</span><span class="hl-5">int64</span><span class="hl-1">, </span><span class="hl-5">error</span><span class="hl-1">)</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#3-add-functions-to-a-registry" id="3-add-functions-to-a-registry" style="color: inherit; text-decoration: none;">
  <h3>3. Add Functions to a Registry</h3>
</a>
<p>For the server, you can now create the registry, which will expose its functions:</p>
<pre><code class="language-go"><span class="hl-4">// server.go</span><br/><br/><span class="hl-7">registry</span><span class="hl-1"> := rpc.</span><span class="hl-0">NewRegistry</span><span class="hl-1">(</span><br/><span class="hl-1">    &amp;local{},</span><br/><span class="hl-1">    remote{},</span><br/><br/><span class="hl-1">    time.Second*</span><span class="hl-8">10</span><span class="hl-1">,</span><br/><span class="hl-1">    context.</span><span class="hl-0">Background</span><span class="hl-1">(),</span><br/><span class="hl-1">    </span><span class="hl-3">nil</span><span class="hl-1">,</span><br/><span class="hl-1">)</span>
</code></pre>
<p>And do the same for the client:</p>
<pre><code class="language-go"><span class="hl-4">// client.go</span><br/><br/><span class="hl-7">registry</span><span class="hl-1"> := rpc.</span><span class="hl-0">NewRegistry</span><span class="hl-1">(</span><br/><span class="hl-1">    &amp;local{},</span><br/><span class="hl-1">    remote{},</span><br/><br/><span class="hl-1">    time.Second*</span><span class="hl-8">10</span><span class="hl-1">,</span><br/><span class="hl-1">    context.</span><span class="hl-0">Background</span><span class="hl-1">(),</span><br/><span class="hl-1">    </span><span class="hl-3">nil</span><span class="hl-1">,</span><br/><span class="hl-1">)</span>
</code></pre>

<a href="#4-link-the-registry-to-a-transport" id="4-link-the-registry-to-a-transport" style="color: inherit; text-decoration: none;">
  <h3>4. Link the Registry to a Transport</h3>
</a>
<p>Next, expose the functions by creating a TCP listener in your <code>main</code> func (you could also use WebSockets, WebRTC or anything that provides a <code>io.ReadWriteCloser</code>):</p>
<pre><code class="language-go"><span class="hl-4">// server.go</span><br/><br/><span class="hl-7">lis</span><span class="hl-1">, </span><span class="hl-7">err</span><span class="hl-1"> := net.</span><span class="hl-0">Listen</span><span class="hl-1">(</span><span class="hl-2">&quot;tcp&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;localhost:1337&quot;</span><span class="hl-1">)</span><br/><span class="hl-6">if</span><span class="hl-1"> err != </span><span class="hl-3">nil</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">panic</span><span class="hl-1">(err)</span><br/><span class="hl-1">}</span><br/><span class="hl-6">defer</span><span class="hl-1"> lis.</span><span class="hl-0">Close</span><span class="hl-1">()</span><br/><br/><span class="hl-6">for</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">func</span><span class="hl-1">() {</span><br/><span class="hl-1">        </span><span class="hl-7">conn</span><span class="hl-1">, </span><span class="hl-7">err</span><span class="hl-1"> := lis.</span><span class="hl-0">Accept</span><span class="hl-1">()</span><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1"> err != </span><span class="hl-3">nil</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-6">return</span><br/><span class="hl-1">        }</span><br/><br/><span class="hl-1">        </span><span class="hl-6">go</span><span class="hl-1"> </span><span class="hl-3">func</span><span class="hl-1">() {</span><br/><span class="hl-1">            </span><span class="hl-6">defer</span><span class="hl-1"> </span><span class="hl-3">func</span><span class="hl-1">() {</span><br/><span class="hl-1">                </span><span class="hl-7">_</span><span class="hl-1"> = conn.</span><span class="hl-0">Close</span><span class="hl-1">()</span><br/><br/><span class="hl-1">                </span><span class="hl-6">if</span><span class="hl-1"> </span><span class="hl-7">err</span><span class="hl-1"> := </span><span class="hl-0">recover</span><span class="hl-1">(); err != </span><span class="hl-3">nil</span><span class="hl-1"> {</span><br/><span class="hl-1">                    log.</span><span class="hl-0">Printf</span><span class="hl-1">(</span><span class="hl-2">&quot;Client disconnected with error: </span><span class="hl-7">%v</span><span class="hl-2">&quot;</span><span class="hl-1">, err)</span><br/><span class="hl-1">                }</span><br/><span class="hl-1">            }()</span><br/><br/><span class="hl-1">            </span><span class="hl-6">if</span><span class="hl-1"> </span><span class="hl-7">err</span><span class="hl-1"> := registry.</span><span class="hl-0">LinkStream</span><span class="hl-1">(</span><br/><span class="hl-1">            json.</span><span class="hl-0">NewEncoder</span><span class="hl-1">(conn).Encode,</span><br/><span class="hl-1">            json.</span><span class="hl-0">NewDecoder</span><span class="hl-1">(conn).Decode,</span><br/><br/><span class="hl-1">            json.Marshal,</span><br/><span class="hl-1">            json.Unmarshal,</span><br/><span class="hl-1">        ); err != </span><span class="hl-3">nil</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-0">panic</span><span class="hl-1">(err)</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">        }()</span><br/><span class="hl-1">    }()</span><br/><span class="hl-1">}</span>
</code></pre>
<p>For the client, do the same, except this time connect to the server by dialing it:</p>
<pre><code class="language-go"><span class="hl-4">// client.go</span><br/><br/><span class="hl-7">conn</span><span class="hl-1">, </span><span class="hl-7">err</span><span class="hl-1"> := net.</span><span class="hl-0">Dial</span><span class="hl-1">(</span><span class="hl-2">&quot;tcp&quot;</span><span class="hl-1">, *addr)</span><br/><span class="hl-6">if</span><span class="hl-1"> err != </span><span class="hl-3">nil</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">panic</span><span class="hl-1">(err)</span><br/><span class="hl-1">}</span><br/><span class="hl-6">defer</span><span class="hl-1"> conn.</span><span class="hl-0">Close</span><span class="hl-1">()</span><br/><br/><span class="hl-6">if</span><span class="hl-1"> </span><span class="hl-7">err</span><span class="hl-1"> := registry.</span><span class="hl-0">LinkStream</span><span class="hl-1">(</span><br/><span class="hl-1">            json.</span><span class="hl-0">NewEncoder</span><span class="hl-1">(conn).Encode,</span><br/><span class="hl-1">            json.</span><span class="hl-0">NewDecoder</span><span class="hl-1">(conn).Decode,</span><br/><br/><span class="hl-1">            json.Marshal,</span><br/><span class="hl-1">            json.Unmarshal,</span><br/><span class="hl-1">        ); err != </span><span class="hl-3">nil</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">panic</span><span class="hl-1">(err)</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#5-call-the-functions" id="5-call-the-functions" style="color: inherit; text-decoration: none;">
  <h3>5. Call the Functions</h3>
</a>
<p>Now you can call the functions exposed on the server from the client and vise versa. For example, to call <code>Println</code>, a function exposed by the client from the server:</p>
<pre><code class="language-go"><span class="hl-4">// server.go</span><br/><br/><span class="hl-6">for</span><span class="hl-1"> </span><span class="hl-7">_</span><span class="hl-1">, </span><span class="hl-7">peer</span><span class="hl-1"> := </span><span class="hl-6">range</span><span class="hl-1"> registry.</span><span class="hl-0">Peers</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-6">if</span><span class="hl-1"> </span><span class="hl-7">err</span><span class="hl-1"> := peer.</span><span class="hl-0">Println</span><span class="hl-1">(ctx, </span><span class="hl-2">&quot;Hello, world!&quot;</span><span class="hl-1">); err != </span><span class="hl-3">nil</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">panic</span><span class="hl-1">(err)</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">}</span>
</code></pre>
<p>Or to call the <code>Increment</code> function exposed by the server on the client:</p>
<pre><code class="language-go"><span class="hl-4">// client.go</span><br/><br/><span class="hl-6">for</span><span class="hl-1"> </span><span class="hl-7">_</span><span class="hl-1">, </span><span class="hl-7">peer</span><span class="hl-1"> := </span><span class="hl-6">range</span><span class="hl-1"> registry.</span><span class="hl-0">Peers</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-7">new</span><span class="hl-1">, </span><span class="hl-7">err</span><span class="hl-1"> := peer.</span><span class="hl-0">Increment</span><span class="hl-1">(ctx, </span><span class="hl-8">1</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-6">if</span><span class="hl-1"> err != </span><span class="hl-3">nil</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">panic</span><span class="hl-1">(err)</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    log.</span><span class="hl-0">Println</span><span class="hl-1">(new)</span><br/><span class="hl-1">}</span>
</code></pre>
<p>By passing the <code>Peers()</code> method to the local service itself, you can also access remote functions in the other direction:</p>
<pre><code class="language-go"><span class="hl-4">// server.go</span><br/><br/><span class="hl-3">type</span><span class="hl-1"> </span><span class="hl-5">local</span><span class="hl-1"> </span><span class="hl-3">struct</span><span class="hl-1"> {</span><br/><span class="hl-1">    counter </span><span class="hl-5">int64</span><br/><br/><span class="hl-1">    Peers </span><span class="hl-3">func</span><span class="hl-1">() </span><span class="hl-3">map</span><span class="hl-1">[</span><span class="hl-5">string</span><span class="hl-1">]remote</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">func</span><span class="hl-1"> (s *local) </span><span class="hl-0">Increment</span><span class="hl-1">(ctx context.Context, delta </span><span class="hl-5">int64</span><span class="hl-1">) (</span><span class="hl-5">int64</span><span class="hl-1">, </span><span class="hl-5">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-7">peerID</span><span class="hl-1"> := rpc.</span><span class="hl-0">GetRemoteID</span><span class="hl-1">(ctx)</span><br/><br/><span class="hl-1">    </span><span class="hl-6">for</span><span class="hl-1"> </span><span class="hl-7">candidateIP</span><span class="hl-1">, </span><span class="hl-7">peer</span><span class="hl-1"> := </span><span class="hl-6">range</span><span class="hl-1"> s.</span><span class="hl-0">Peers</span><span class="hl-1">() {</span><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1"> candidateIP == peerID {</span><br/><span class="hl-1">            peer.</span><span class="hl-0">Println</span><span class="hl-1">(ctx, fmt.</span><span class="hl-0">Sprintf</span><span class="hl-1">(</span><span class="hl-2">&quot;Incrementing counter by </span><span class="hl-7">%v</span><span class="hl-2">&quot;</span><span class="hl-1">, delta))</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-6">return</span><span class="hl-1"> atomic.</span><span class="hl-0">AddInt64</span><span class="hl-1">(&amp;s.counter, delta), </span><span class="hl-3">nil</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-4">// In `main`:</span><br/><span class="hl-7">service</span><span class="hl-1"> := &amp;local{}</span><br/><span class="hl-7">registry</span><span class="hl-1"> := rpc.</span><span class="hl-0">NewRegistry</span><span class="hl-1">(</span><br/><span class="hl-1">    service,</span><br/><span class="hl-1">    remote{},</span><br/><br/><span class="hl-1">    time.Second*</span><span class="hl-8">10</span><span class="hl-1">,</span><br/><span class="hl-1">    context.</span><span class="hl-0">Background</span><span class="hl-1">(),</span><br/><span class="hl-1">    </span><span class="hl-3">nil</span><span class="hl-1">,</span><br/><span class="hl-1">)</span><br/><span class="hl-7">service.Peers</span><span class="hl-1"> = registry.Peers</span>
</code></pre>

<a href="#6-using-closures-and-callbacks" id="6-using-closures-and-callbacks" style="color: inherit; text-decoration: none;">
  <h3>6. Using Closures and Callbacks</h3>
</a>
<p>Because dudirekta is bidirectional, it is possible to pass closures and callbacks as function arguments, just like you would locally. For example, on the server:</p>
<pre><code class="language-go"><span class="hl-4">// server.go</span><br/><br/><span class="hl-3">type</span><span class="hl-1"> </span><span class="hl-5">local</span><span class="hl-1"> </span><span class="hl-3">struct</span><span class="hl-1">{}</span><br/><br/><span class="hl-3">func</span><span class="hl-1"> (s *local) </span><span class="hl-0">Iterate</span><span class="hl-1">(</span><br/><span class="hl-1">    ctx context.Context,</span><br/><span class="hl-1">    length </span><span class="hl-5">int</span><span class="hl-1">,</span><br/><span class="hl-1">    onIteration </span><span class="hl-3">func</span><span class="hl-1">(i </span><span class="hl-5">int</span><span class="hl-1">, b </span><span class="hl-5">string</span><span class="hl-1">) (</span><span class="hl-5">string</span><span class="hl-1">, </span><span class="hl-5">error</span><span class="hl-1">),</span><br/><span class="hl-1">) (</span><span class="hl-5">int</span><span class="hl-1">, </span><span class="hl-5">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-6">for</span><span class="hl-1"> </span><span class="hl-7">i</span><span class="hl-1"> := </span><span class="hl-8">0</span><span class="hl-1">; i &lt; length; i++ {</span><br/><span class="hl-1">        </span><span class="hl-7">rv</span><span class="hl-1">, </span><span class="hl-7">err</span><span class="hl-1"> := </span><span class="hl-0">onIteration</span><span class="hl-1">(i, </span><span class="hl-2">&quot;This is from the callee&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1"> err != </span><span class="hl-3">nil</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-6">return</span><span class="hl-1"> -</span><span class="hl-8">1</span><span class="hl-1">, err</span><br/><span class="hl-1">        }</span><br/><br/><span class="hl-1">        log.</span><span class="hl-0">Println</span><span class="hl-1">(</span><span class="hl-2">&quot;Closure returned:&quot;</span><span class="hl-1">, rv)</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-6">return</span><span class="hl-1"> length, </span><span class="hl-3">nil</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">type</span><span class="hl-1"> </span><span class="hl-5">remote</span><span class="hl-1"> </span><span class="hl-3">struct</span><span class="hl-1">{}</span>
</code></pre>
<p>And the client:</p>
<pre><code class="language-go"><span class="hl-4">// client.go</span><br/><br/><span class="hl-3">type</span><span class="hl-1"> </span><span class="hl-5">local</span><span class="hl-1"> </span><span class="hl-3">struct</span><span class="hl-1">{}</span><br/><br/><span class="hl-3">type</span><span class="hl-1"> </span><span class="hl-5">remote</span><span class="hl-1"> </span><span class="hl-3">struct</span><span class="hl-1"> {</span><br/><span class="hl-1">    Iterate </span><span class="hl-3">func</span><span class="hl-1">(</span><br/><span class="hl-1">        ctx context.Context,</span><br/><span class="hl-1">        length </span><span class="hl-5">int</span><span class="hl-1">,</span><br/><span class="hl-1">        onIteration </span><span class="hl-3">func</span><span class="hl-1">(i </span><span class="hl-5">int</span><span class="hl-1">, b </span><span class="hl-5">string</span><span class="hl-1">) (</span><span class="hl-5">string</span><span class="hl-1">, </span><span class="hl-5">error</span><span class="hl-1">),</span><br/><span class="hl-1">    ) (</span><span class="hl-5">int</span><span class="hl-1">, </span><span class="hl-5">error</span><span class="hl-1">)</span><br/><span class="hl-1">}</span>
</code></pre>
<p>When you call <code>peer.Iterate</code>, you can now pass in a closure:</p>
<pre><code class="language-go"><span class="hl-4">// client.go</span><br/><br/><span class="hl-6">for</span><span class="hl-1"> </span><span class="hl-7">_</span><span class="hl-1">, </span><span class="hl-7">peer</span><span class="hl-1"> := </span><span class="hl-6">range</span><span class="hl-1"> registry.</span><span class="hl-0">Peers</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-7">length</span><span class="hl-1">, </span><span class="hl-7">err</span><span class="hl-1"> := </span><span class="hl-0">Iterate</span><span class="hl-1">(peer, ctx, </span><span class="hl-8">5</span><span class="hl-1">, </span><span class="hl-3">func</span><span class="hl-1">(i </span><span class="hl-5">int</span><span class="hl-1">, b </span><span class="hl-5">string</span><span class="hl-1">) (</span><span class="hl-5">string</span><span class="hl-1">, </span><span class="hl-5">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        log.</span><span class="hl-0">Println</span><span class="hl-1">(</span><span class="hl-2">&quot;In iteration&quot;</span><span class="hl-1">, i, b)</span><br/><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-2">&quot;This is from the caller&quot;</span><span class="hl-1">, </span><span class="hl-3">nil</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    </span><span class="hl-6">if</span><span class="hl-1"> err != </span><span class="hl-3">nil</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">panic</span><span class="hl-1">(err)</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    log.</span><span class="hl-0">Println</span><span class="hl-1">(length)</span><br/><span class="hl-1">}</span>
</code></pre>
<p>ðŸš€ That&#39;s it! We can&#39;t wait to see what you&#39;re going to build with dudirekta.</p>

<a href="#reference" id="reference" style="color: inherit; text-decoration: none;">
  <h2>Reference</h2>
</a>

<a href="#examples" id="examples" style="color: inherit; text-decoration: none;">
  <h3>Examples</h3>
</a>
<p>To make getting started with dudirekta easier, take a look at the following examples:</p>
<ul>
<li><strong>TCP Transport</strong><ul>
<li><a href="./cmd/dudirekta-example-tcp-server/main.go">TCP Server</a></li>
<li><a href="./cmd/dudirekta-example-tcp-client/main.go">TCP Client</a></li>
</ul>
</li>
<li><strong>WebSocket Transport</strong><ul>
<li><a href="./cmd/dudirekta-example-websocket-server/main.go">WebSocket Server</a></li>
<li><a href="./cmd/dudirekta-example-websocket-client/main.go">WebSocket Client</a></li>
</ul>
</li>
<li><strong>WebRTC Transport</strong><ul>
<li><a href="./cmd/dudirekta-example-webrtc-peer/main.go">WebRTC Peer</a></li>
</ul>
</li>
<li><strong>Callbacks</strong><ul>
<li><a href="./cmd/dudirekta-example-callbacks-callee/main.go">Callbacks Demo Server</a></li>
<li><a href="./cmd/dudirekta-example-callbacks-caller/main.go">Callbacks Demo Client</a></li>
</ul>
</li>
<li><strong>Closures</strong><ul>
<li><a href="./cmd/dudirekta-example-closures-callee/main.go">Closures Demo Server</a></li>
<li><a href="./cmd/dudirekta-example-closures-caller/main.go">Closures Demo Client</a></li>
</ul>
</li>
</ul>

<a href="#protocol" id="protocol" style="color: inherit; text-decoration: none;">
  <h3>Protocol</h3>
</a>
<p>The protocol used by dudirekta is simple and based on JSONL.</p>
<p>A function call to e.g. the <code>Println</code> function from above looks like this:</p>
<pre><code class="language-json"><span class="hl-1">[</span><span class="hl-3">true</span><span class="hl-1">, </span><span class="hl-2">&quot;1&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;Println&quot;</span><span class="hl-1">, [</span><span class="hl-2">&quot;Hello, world!&quot;</span><span class="hl-1">]]</span>
</code></pre>
<p>The first element specifies whether the message is a function call (<code>true</code>) or return (<code>false</code>). The second element is the ID of the function call, generated by the client; the third element is the function name and the last element is an array of the function&#39;s arguments serialized to JSON.</p>
<p>A function return looks like this:</p>
<pre><code class="language-json"><span class="hl-1">[</span><span class="hl-3">false</span><span class="hl-1">, </span><span class="hl-2">&quot;1&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">]</span>
</code></pre>
<p>Here, the first element specifies that the message is a function return (<code>false</code>). The second element is the ID of the function call from above, the third element is the function&#39;s return value serialized to JSON, and the last element is the error message; <code>nil</code> errors are represented by the empty string.</p>
<p>Keep in mind that dudirekta is bidirectional, meaning that both the client and server can send and receive both types of messages to each other.</p>

<a href="#acknowledgements" id="acknowledgements" style="color: inherit; text-decoration: none;">
  <h2>Acknowledgements</h2>
</a>
<ul>
<li><a href="https://github.com/zserge/lorca">zserge/lorca</a> inspired the API design.</li>
</ul>

<a href="#contributing" id="contributing" style="color: inherit; text-decoration: none;">
  <h2>Contributing</h2>
</a>
<p>To contribute, please use the <a href="https://guides.github.com/introduction/flow/">GitHub flow</a> and follow our <a href="./CODE_OF_CONDUCT.md">Code of Conduct</a>.</p>
<p>To build and start a development version of dudirekta locally, run the following:</p>
<pre><code class="language-shell"><span class="hl-0">$</span><span class="hl-1"> </span><span class="hl-2">git</span><span class="hl-1"> </span><span class="hl-2">clone</span><span class="hl-1"> </span><span class="hl-2">https://github.com/pojntfx/dudirekta.git</span><br/><span class="hl-0">$</span><span class="hl-1"> </span><span class="hl-2">cd</span><span class="hl-1"> </span><span class="hl-2">dudirekta</span><br/><span class="hl-0">$</span><span class="hl-1"> </span><span class="hl-2">go</span><span class="hl-1"> </span><span class="hl-2">run</span><span class="hl-1"> </span><span class="hl-2">./cmd/dudirekta-example-tcp-server/</span><span class="hl-1"> </span><span class="hl-4"># Starts the TCP example server</span><br/><span class="hl-4"># In another terminal</span><br/><span class="hl-0">$</span><span class="hl-1"> </span><span class="hl-2">go</span><span class="hl-1"> </span><span class="hl-2">run</span><span class="hl-1"> </span><span class="hl-2">./cmd/dudirekta-example-tcp-client/</span><span class="hl-1"> </span><span class="hl-4"># Starts the TCP example client</span>
</code></pre>
<p>Have any questions or need help? Chat with us <a href="https://matrix.to/#/#dudirekta:matrix.org?via=matrix.org">on Matrix</a>!</p>

<a href="#license" id="license" style="color: inherit; text-decoration: none;">
  <h2>License</h2>
</a>
<p>dudirekta (c) 2023 Felicitas Pojtinger and contributors</p>
<p>SPDX-License-Identifier: Apache-2.0</p>
</div></div>
<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
<div class="tsd-navigation settings">
<details class="tsd-index-accordion"><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Settings</h3></summary>
<div class="tsd-accordion-details">
<div class="tsd-filter-visibility">
<h4 class="uppercase">Member Visibility</h4><form>
<ul id="tsd-filter-options">
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div>
<div class="tsd-theme-toggle">
<h4 class="uppercase">Theme</h4><select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div>
<nav class="tsd-navigation primary">
<details class="tsd-index-accordion" open><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Modules</h3></summary>
<div class="tsd-accordion-details">
<ul>
<li class="current selected"><a href="modules.html">@pojntfx/dudirekta</a>
<ul></ul></li></ul></div></details></nav>
<nav class="tsd-navigation secondary menu-sticky">
<ul>
<li class="tsd-kind-interface"><a href="interfaces/IBindConfig.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-interface)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6" id="icon-256-path"></rect><path d="M9.51 16V15.016H11.298V8.224H9.51V7.24H14.19V8.224H12.402V15.016H14.19V16H9.51Z" fill="var(--color-text)" id="icon-256-text"></path></svg>IBind<wbr/>Config</a></li>
<li class="tsd-kind-function"><a href="functions/bind.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-function)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6" id="icon-64-path"></rect><path d="M9.39 16V7.24H14.55V8.224H10.446V11.128H14.238V12.112H10.47V16H9.39Z" fill="var(--color-text)" id="icon-64-text"></path></svg>bind</a></li></ul></nav></div></div>
<div class="container tsd-generator">
<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div>
<div class="overlay"></div><script src="assets/main.js"></script></body></html>